<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <link rel="stylesheet" href="css/leaflet-measure.css">
    <style>
    html, body, #map { width: 100%; height: 100%; padding: 0; margin: 0; }
    .legend-control { background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); font-family: Arial, sans-serif; min-width: 320px; max-width: 380px; }
    .legend-header { background: linear-gradient(135deg, #1e40af, #3b82f6); color: #fff; padding: 10px 12px; font-weight: bold; font-size: 13px; border-radius: 8px 8px 0 0; }
    .legend-content { max-height: 65vh; overflow-y: auto; padding: 6px; }
    .legend-group { margin-bottom: 4px; border: 1px solid #e5e7eb; border-radius: 5px; }
    .group-header { background: #f3f4f6; padding: 6px 8px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; font-size: 11px; font-weight: 600; }
    .group-header:hover { background: #e5e7eb; }
    .group-items { padding: 4px 6px; }
    .group-items.hidden { display: none; }
    .layer-item { display: flex; align-items: center; gap: 5px; padding: 3px 2px; font-size: 10px; cursor: pointer; }
    .layer-item:hover { background: #f9fafb; border-radius: 3px; }
    .layer-item input { width: 12px; height: 12px; accent-color: #2563eb; }
    .layer-item label { flex: 1; cursor: pointer; color: #374151; }
    .sym-pt { width: 10px; height: 10px; border-radius: 50%; border: 1px solid #333; }
    .sym-ln { width: 16px; height: 3px; border-radius: 1px; }
    .sym-pg { width: 10px; height: 10px; border: 1px solid #333; }
    .sym-rs { width: 10px; height: 10px; border-radius: 2px; border: 1px solid #ccc; }
    .legend-footer { padding: 6px 8px; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; font-size: 9px; background: #f9fafb; border-radius: 0 0 8px 8px; }
    .legend-footer button { padding: 3px 8px; font-size: 9px; border: none; border-radius: 3px; cursor: pointer; }
    .btn-show { background: #2563eb; color: #fff; }
    .btn-hide { background: #6b7280; color: #fff; }
    .grp-btns button { padding: 1px 4px; font-size: 8px; border: none; border-radius: 2px; cursor: pointer; margin-left: 2px; }
    .btn-all { background: #10b981; color: #fff; }
    .btn-none { background: #ef4444; color: #fff; }
    .opt-box { min-width: 14px; height: 14px; background: #f3f4f6; border: 1px solid #999; border-radius: 2px; font-size: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #333; flex-shrink: 0; }
    .priority-legend { display: flex; flex-wrap: wrap; gap: 6px; padding: 4px 6px; background: #f9fafb; border-radius: 4px; margin-top: 4px; }
    .priority-item { display: flex; align-items: center; gap: 3px; font-size: 9px; }
    .priority-legend-vertical { display: flex; flex-direction: column; gap: 4px; padding: 6px; background: #f9fafb; border-radius: 4px; margin-top: 4px; }
    .priority-item-v { display: flex; align-items: center; gap: 6px; font-size: 9px; }
    </style>
    <title>Identification of Priority Area and Option forSustainable Landscape Management (SLM) In Knuckles Mountain Region Sri Lanka 
</title>
</head>
<body>
<div id="map"></div>
<script src="js/leaflet.js"></script>
<script src="js/L.Control.Layers.Tree.min.js"></script>
<script src="js/leaflet-hash.js"></script>
<script src="js/Autolinker.min.js"></script>
<script src="js/rbush.min.js"></script>
<script src="js/labelgun.min.js"></script>
<script src="js/labels.js"></script>
<script src="js/leaflet-measure.js"></script>
<script src="data/UpstreamDownstreamBoundary_9.js"></script>
<script src="data/GramaNiladhariDivisionBoundary_10.js"></script>
<script src="data/DivisionalSecretariatDivisionBoundary_11.js"></script>
<script src="data/DistrictBoundary_12.js"></script>
<script src="data/ProvienceBoundary_13.js"></script>
<script src="data/ProjectBoundary_14.js"></script>
<script src="data/Activity121IncreasingcroppingintensityofirrigatedricePolygon_15.js"></script>
<script src="data/Activity113RestorationofforestmosaiclandscapesPolygon_16.js"></script>
<script src="data/Activity113RestorationofforestmosaiclandscapesPolyline_17.js"></script>
<script src="data/Activity123Restorationandintensificationofsustainableplantations_18.js"></script>
<script src="data/Activity122Intensificationofsustainablesmallholderproduction_19.js"></script>
<script src="data/Activity121IncreasingcroppingintensityofirrigatedricePolyline_20.js"></script>
<script src="data/Activity113RestorationofforestmosaiclandscapesPoint_21.js"></script>
<script src="data/Activity112Rehabilitationandestablishmentofvillagetankspondsandirrigationnetworks_22.js"></script>
<script src="data/Activity111StreamsideProtectionanddrainagemanagementalongsroads_23.js"></script>

<script>
// === MAP INIT ===
var map = L.map('map', {zoomControl:false, maxZoom:28, minZoom:1}).fitBounds([[7.22,80.21],[8.09,81.61]]);
L.control.zoom({position:'topleft'}).addTo(map);
new L.Hash(map);

// === HIGHLIGHT ===
function hl(e) {
    var l = e.target;
    var g = l.feature.geometry.type;
    if (g.includes('Line')) l.setStyle({color:'#ffff00'});
    else l.setStyle({fillColor:'#ffff00',fillOpacity:1});
    l.openPopup();
}
function bindP(f,l,props) {
    l.on({mouseout:function(e){for(var i in e.target._eventParents){if(typeof e.target._eventParents[i].resetStyle==='function')e.target._eventParents[i].resetStyle(e.target);}l.closePopup();},mouseover:hl});
    var h='<table>';
    props.forEach(function(p){if(f.properties[p.k])h+='<tr><td><b>'+p.n+':</b> '+f.properties[p.k]+'</td></tr>';});
    l.bindPopup(h+'</table>',{maxHeight:400});
}

// === LAYERS ===
var layers = {};
var rb = [[7.19,79.83],[8.44,81.06]];

// Base
layers.osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19});
map.addLayer(layers.osm);

// Rasters - Priorities of Intervention
layers.loc = L.imageOverlay('data/LocationbasedPriorityInterventionOption_1.png',rb);
layers.plant = L.imageOverlay('data/Restorationandsustainableintensificationofplantations_2.png',rb);
layers.small = L.imageOverlay('data/Sustainableintensificationofsmallholderproduction_3.png',rb);
layers.rice = L.imageOverlay('data/Increasingcroppingintensityofirrigatedriceinbothupstreamanddownstreamareas_4.png',rb);
layers.forest = L.imageOverlay('data/Restorationofforestmosaiclandscapes_5.png',rb);
layers.tanks = L.imageOverlay('data/Rehabilitationandestablishmentofvillagetankspondsandirrigationnetworks_6.png',rb);
layers.drain = L.imageOverlay('data/Drainagemanagementalongroads_7.png',rb);
layers.stream = L.imageOverlay('data/Streamsideprotection_8.png',rb);

// Boundaries
layers.updown = L.geoJson(json_UpstreamDownstreamBoundary_9,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'Name',n:'Name'},{k:'Updo',n:'Type'}]);},
    style:function(f){return{color:f.properties.Updo==='Upstream'?'#b10a39':'#265eb1',weight:4,fillOpacity:0};}
});
layers.gnd = L.geoJson(json_GramaNiladhariDivisionBoundary_10,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'GND_N',n:'GND'}]);},
    style:function(){return{color:'#110202',weight:2,fillOpacity:0};}
});
layers.dsd = L.geoJson(json_DivisionalSecretariatDivisionBoundary_11,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'DSD_N',n:'DSD'}]);},
    style:function(){return{color:'#555',weight:3,fillOpacity:0};}
});
layers.dist = L.geoJson(json_DistrictBoundary_12,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'DISTRICT_N',n:'District'}]);},
    style:function(){return{color:'#333',weight:4,fillOpacity:0};}
});
layers.prov = L.geoJson(json_ProvienceBoundary_13,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'PROVINCE_N',n:'Province'}]);},
    style:function(){return{color:'#111',weight:5,fillOpacity:0};}
});
layers.proj = L.geoJson(json_ProjectBoundary_14,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'SIDT_1',n:'Project'}]);},
    style:function(){return{color:'#e41a1c',weight:4,fillOpacity:0};}
});

// Activities of PMU - DENGAN WARNA BARU
layers.a111 = L.geoJson(json_Activity111StreamsideProtectionanddrainagemanagementalongsroads_23,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'Name',n:'Name'}]);},
    pointToLayer:function(f,ll){return L.circleMarker(ll,{radius:5,fillColor:'#6B7F1E',color:'#333',weight:1,fillOpacity:1});}
});
layers.a112 = L.geoJson(json_Activity112Rehabilitationandestablishmentofvillagetankspondsandirrigationnetworks_22,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'Name_of_th',n:'Name'}]);},
    pointToLayer:function(f,ll){return L.circleMarker(ll,{radius:5,fillColor:'#00BCD4',color:'#333',weight:1,fillOpacity:1});}
});
layers.a113pt = L.geoJson(json_Activity113RestorationofforestmosaiclandscapesPoint_21,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'Name',n:'Name'}]);},
    pointToLayer:function(f,ll){return L.circleMarker(ll,{radius:5,fillColor:'#8BC34A',color:'#333',weight:1,fillOpacity:1});}
});
layers.a121pt = L.geoJson(json_Activity121IncreasingcroppingintensityofirrigatedricePolyline_20,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'Name',n:'Name'}]);},
    pointToLayer:function(f,ll){return L.circleMarker(ll,{radius:5,fillColor:'#7B1FA2',color:'#333',weight:1,fillOpacity:1});}
});
layers.a122 = L.geoJson(json_Activity122Intensificationofsustainablesmallholderproduction_19,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'Name',n:'Name'}]);},
    pointToLayer:function(f,ll){return L.circleMarker(ll,{radius:5,fillColor:'#03A9F4',color:'#333',weight:1,fillOpacity:1});}
});
layers.a123 = L.geoJson(json_Activity123Restorationandintensificationofsustainableplantations_18,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'Name',n:'Name'},{k:'Division_N',n:'Division'}]);},
    pointToLayer:function(f,ll){return L.circleMarker(ll,{radius:5,fillColor:'#F8BBD0',color:'#333',weight:1,fillOpacity:1});}
});
layers.a113l = L.geoJson(json_Activity113RestorationofforestmosaiclandscapesPolyline_17,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'Name',n:'Name'}]);},
    style:function(){return{color:'#8BC34A',weight:2};}
});
layers.a113p = L.geoJson(json_Activity113RestorationofforestmosaiclandscapesPolygon_16,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'Name',n:'Name'}]);},
    style:function(){return{color:'#333',weight:1,fillColor:'#8BC34A',fillOpacity:1};}
});
layers.a121p = L.geoJson(json_Activity121IncreasingcroppingintensityofirrigatedricePolygon_15,{
    onEachFeature:function(f,l){bindP(f,l,[{k:'Name',n:'Name'}]);},
    style:function(){return{color:'#333',weight:1,fillColor:'#7B1FA2',fillOpacity:1};}
});

// Add all layers
Object.keys(layers).forEach(function(k){map.addLayer(layers[k]);});

// === LEGEND CONTROL ===
var Legend = L.Control.extend({
    options:{position:'topright'},
    onAdd:function(){
        var c = L.DomUtil.create('div','legend-control');
        L.DomEvent.disableClickPropagation(c);
        L.DomEvent.disableScrollPropagation(c);
        c.innerHTML = `
<div class="legend-header">üó∫Ô∏è Map Legend</div>
<div class="legend-content">

<!-- Activities of PMU -->
<div class="legend-group"><div class="group-header" onclick="tg('act')"><span>‚ñº Activities of PMU</span><div class="grp-btns"><button class="btn-all" onclick="event.stopPropagation();ta('act',1)">All</button><button class="btn-none" onclick="event.stopPropagation();ta('act',0)">None</button></div></div>
<div class="group-items" id="g-act">
<div class="layer-item"><input type="checkbox" id="c_a111" checked onchange="tl('a111')"><div class="sym-pt" style="background:#6B7F1E"></div><label for="c_a111">Activity 1.1.1 Streamside Protection and drainage management alongs roads</label></div>
<div class="layer-item"><input type="checkbox" id="c_a112" checked onchange="tl('a112')"><div class="sym-pt" style="background:#00BCD4"></div><label for="c_a112">Activity 1.1.2 Rehabilitation and establishment of village tanks, ponds and irrigation networks</label></div>
<div class="layer-item"><input type="checkbox" id="c_a113pt" checked onchange="tl('a113pt')"><div class="sym-pt" style="background:#8BC34A"></div><label for="c_a113pt">Activity 1.1.3 Restoration of forest mosaic landscapes - Point</label></div>
<div class="layer-item"><input type="checkbox" id="c_a121pt" checked onchange="tl('a121pt')"><div class="sym-pt" style="background:#7B1FA2"></div><label for="c_a121pt">Activity 1.2.1 Increasing cropping intensity of irrigated rice - Polyline</label></div>
<div class="layer-item"><input type="checkbox" id="c_a122" checked onchange="tl('a122')"><div class="sym-pt" style="background:#03A9F4"></div><label for="c_a122">Activity 1.2.2 Intensification of sustainable smallholder production</label></div>
<div class="layer-item"><input type="checkbox" id="c_a123" checked onchange="tl('a123')"><div class="sym-pt" style="background:#F8BBD0"></div><label for="c_a123">Activity 1.2.3 Restoration and intensification of sustainable plantations</label></div>
<div class="layer-item"><input type="checkbox" id="c_a113l" checked onchange="tl('a113l')"><div class="sym-ln" style="background:#8BC34A"></div><label for="c_a113l">Activity 1.1.3 Restoration of forest mosaic landscapes - Polyline</label></div>
<div class="layer-item"><input type="checkbox" id="c_a113p" checked onchange="tl('a113p')"><div class="sym-pg" style="background:#8BC34A"></div><label for="c_a113p">Activity 1.1.3 Restoration of forest mosaic landscapes - Polygon</label></div>
<div class="layer-item"><input type="checkbox" id="c_a121p" checked onchange="tl('a121p')"><div class="sym-pg" style="background:#7B1FA2"></div><label for="c_a121p">Activity 1.2.1 Increasing cropping intensity of irrigated rice - Polygon</label></div>
</div></div>

<!-- Boundaries -->
<div class="legend-group"><div class="group-header" onclick="tg('bnd')"><span>‚ñº Boundaries</span><div class="grp-btns"><button class="btn-all" onclick="event.stopPropagation();ta('bnd',1)">All</button><button class="btn-none" onclick="event.stopPropagation();ta('bnd',0)">None</button></div></div>
<div class="group-items" id="g-bnd">
<div class="layer-item"><input type="checkbox" id="c_updown" checked onchange="tl('updown')"><div class="sym-ln" style="background:linear-gradient(90deg,#b10a39,#265eb1)"></div><label for="c_updown">Upstream/Downstream Boundary</label></div>
<div class="layer-item"><input type="checkbox" id="c_gnd" checked onchange="tl('gnd')"><div class="sym-ln" style="background:#110202"></div><label for="c_gnd">Grama Niladhari Division Boundary</label></div>
<div class="layer-item"><input type="checkbox" id="c_dsd" checked onchange="tl('dsd')"><div class="sym-ln" style="background:#555"></div><label for="c_dsd">Divisional Secretariat Division Boundary</label></div>
<div class="layer-item"><input type="checkbox" id="c_dist" checked onchange="tl('dist')"><div class="sym-ln" style="background:#333"></div><label for="c_dist">District Boundary</label></div>
<div class="layer-item"><input type="checkbox" id="c_prov" checked onchange="tl('prov')"><div class="sym-ln" style="background:#111"></div><label for="c_prov">Province Boundary</label></div>
<div class="layer-item"><input type="checkbox" id="c_proj" checked onchange="tl('proj')"><div class="sym-ln" style="background:#e41a1c"></div><label for="c_proj">Project Boundary</label></div>
</div></div>

<!-- Priorities of Intervention -->
<div class="legend-group"><div class="group-header" onclick="tg('priority')"><span>‚ñº Priorities of Intervention</span><div class="grp-btns"><button class="btn-all" onclick="event.stopPropagation();ta('priority',1)">All</button><button class="btn-none" onclick="event.stopPropagation();ta('priority',0)">None</button></div></div>
<div class="group-items" id="g-priority">
<div class="layer-item"><input type="checkbox" id="c_stream" checked onchange="tl('stream')"><div class="opt-box">1</div><label for="c_stream">Streamside protection</label></div>
<div class="layer-item"><input type="checkbox" id="c_drain" checked onchange="tl('drain')"><div class="opt-box">2</div><label for="c_drain">Drainage management along roads</label></div>
<div class="layer-item"><input type="checkbox" id="c_tanks" checked onchange="tl('tanks')"><div class="opt-box">3</div><label for="c_tanks">Rehabilitation and establishment of village tanks, ponds and irrigation networks</label></div>
<div class="layer-item"><input type="checkbox" id="c_forest" checked onchange="tl('forest')"><div class="opt-box">4</div><label for="c_forest">Restoration of forest mosaic landscapes</label></div>
<div class="layer-item"><input type="checkbox" id="c_rice" checked onchange="tl('rice')"><div class="opt-box">5</div><label for="c_rice">Increasing cropping intensity of irrigated rice in both upstream and downstream areas</label></div>
<div class="layer-item"><input type="checkbox" id="c_small" checked onchange="tl('small')"><div class="opt-box">6</div><label for="c_small">Sustainable intensification of smallholder production</label></div>
<div class="layer-item"><input type="checkbox" id="c_plant" checked onchange="tl('plant')"><div class="opt-box">7</div><label for="c_plant">Restoration and sustainable intensification of plantations</label></div>
<div class="priority-legend">
    <div class="priority-item"><div class="sym-rs" style="background:#FF0000; width:12px; height:12px;"></div><span>High Priority</span></div>
    <div class="priority-item"><div class="sym-rs" style="background:#FFFF00; width:12px; height:12px;"></div><span>Medium Priority</span></div>
    <div class="priority-item"><div class="sym-rs" style="background:#90EE90; width:12px; height:12px;"></div><span>Low Priority</span></div>
    <div class="priority-item"><div class="sym-rs" style="background:#006400; width:12px; height:12px;"></div><span>No Priority</span></div>
</div>
</div></div>

<!-- Location Based Priority -->
<div class="legend-group"><div class="group-header" onclick="tg('loc')"><span>‚ñº Location Based Priority</span></div>
<div class="group-items" id="g-loc">
<div class="layer-item"><input type="checkbox" id="c_loc" checked onchange="tl('loc')"><div class="sym-rs" style="background:#888"></div><label for="c_loc">Location based Priority Intervention Option</label></div>
<div class="priority-legend-vertical">
    <div class="priority-item-v"><div class="sym-rs" style="background:#6B7F1E; width:12px; height:12px;"></div><span>Streamside protection</span></div>
    <div class="priority-item-v"><div class="sym-rs" style="background:#FFEB3B; width:12px; height:12px;"></div><span>Drainage management along roads</span></div>
    <div class="priority-item-v"><div class="sym-rs" style="background:#00BCD4; width:12px; height:12px;"></div><span>Rehabilitation and establishment of village tanks, ponds and irrigation networks</span></div>
    <div class="priority-item-v"><div class="sym-rs" style="background:#8BC34A; width:12px; height:12px;"></div><span>Restoration of forest mosaic landscapes</span></div>
    <div class="priority-item-v"><div class="sym-rs" style="background:#7B1FA2; width:12px; height:12px;"></div><span>Increasing cropping intensity of irrigated rice in both upstream and downstream areas</span></div>
    <div class="priority-item-v"><div class="sym-rs" style="background:#03A9F4; width:12px; height:12px;"></div><span>Sustainable intensification of smallholder production</span></div>
    <div class="priority-item-v"><div class="sym-rs" style="background:#F8BBD0; width:12px; height:12px;"></div><span>Restoration and sustainable intensification of plantations</span></div>
</div>
</div></div>

<!-- Basemap -->
<div class="legend-group"><div class="group-header" onclick="tg('base')"><span>‚ñº Basemap</span></div>
<div class="group-items" id="g-base">
<div class="layer-item"><input type="checkbox" id="c_osm" checked onchange="tl('osm')"><div class="sym-rs" style="background:linear-gradient(135deg,#aaa,#555)"></div><label for="c_osm">OpenStreetMap</label></div>
</div></div>

</div>
<div class="legend-footer"><span id="cnt">24/24 layers</span><div><button class="btn-show" onclick="showAll()">Show All</button><button class="btn-hide" onclick="hideAll()">Hide All</button></div></div>`;
        return c;
    }
});
map.addControl(new Legend());

// === LEGEND FUNCTIONS ===
var grpLayers = {
    base:['osm'],
    priority:['loc','plant','small','rice','forest','tanks','drain','stream'],
    bnd:['updown','gnd','dsd','dist','prov','proj'],
    act:['a111','a112','a113pt','a121pt','a122','a123','a113l','a113p','a121p']
};

function tl(id) {
    var chk = document.getElementById('c_'+id);
    if(chk.checked) map.addLayer(layers[id]);
    else map.removeLayer(layers[id]);
    updCnt();
}
function tg(g) {
    var el = document.getElementById('g-'+g);
    el.classList.toggle('hidden');
}
function ta(g,on) {
    grpLayers[g].forEach(function(id){
        var chk = document.getElementById('c_'+id);
        chk.checked = on;
        if(on) map.addLayer(layers[id]);
        else map.removeLayer(layers[id]);
    });
    updCnt();
}
function showAll() {
    Object.keys(layers).forEach(function(id){
        document.getElementById('c_'+id).checked = true;
        map.addLayer(layers[id]);
    });
    updCnt();
}
function hideAll() {
    Object.keys(layers).forEach(function(id){
        document.getElementById('c_'+id).checked = false;
        map.removeLayer(layers[id]);
    });
    updCnt();
}
function updCnt() {
    var t = Object.keys(layers).length;
    var v = 0;
    Object.keys(layers).forEach(function(id){ if(map.hasLayer(layers[id])) v++; });
    document.getElementById('cnt').innerText = v+'/'+t+' layers';
}
</script>
</body>
</html>